<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="viewport" content="width=device-width, initial-scale=1" />
<title>安装ElementaryOS Freya后的配置</title>
<meta  name="generator" content="Org-mode" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<link rel="stylesheet" href="../stylesheets/Github2.css"/>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">安装ElementaryOS Freya后的配置</h1>
<p>
Elementary据说是颜值最高的Linux发行版。刚好屋子里有一个笔记本暂时闲置在那里。于是就拿来折腾安装了ElementaryOS Freya。配置使用了之后，发现还挺不错的。不过针对果然的使用习惯还是有很多地方需要配置的。本文记录了我的ElementaryOS过程。
</p>

<p>
<!-- more -->
</p>

<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgheadline1">eOS截图</a></li>
<li><a href="#orgheadline2">选择阿里云的源</a></li>
<li><a href="#orgheadline3">安装受版权限制的软件</a></li>
<li><a href="#orgheadline4">安装系统监控器</a></li>
<li><a href="#orgheadline5">用户脚本目录.usrbin</a></li>
<li><a href="#orgheadline6">改主机名称</a></li>
<li><a href="#orgheadline7">安装gdebi工具</a></li>
<li><a href="#orgheadline8">安装Emacs24.5</a></li>
<li><a href="#orgheadline9">安装Atom</a></li>
<li><a href="#orgheadline10">安装Sublime Text 3</a></li>
<li><a href="#orgheadline11">安装StarUML</a></li>
<li><a href="#orgheadline12">安装SmartGit</a></li>
<li><a href="#orgheadline13">安装Elementary Tweaks</a></li>
<li><a href="#orgheadline14">安装oracle-jdk</a></li>
<li><a href="#orgheadline15">安装IntelliJ-IDEA</a></li>
<li><a href="#orgheadline16">安装Google Chrome</a></li>
<li><a href="#orgheadline17">安装Lantern</a></li>
<li><a href="#orgheadline18">安装搜狗输入法</a></li>
<li><a href="#orgheadline19">Atom支持中文显示</a></li>
<li><a href="#orgheadline20">Sublime支持中文输入</a></li>
<li><a href="#orgheadline21">Scratch支持中文输入</a></li>
<li><a href="#orgheadline22">Emacs中文输入和闪退问题</a></li>
<li><a href="#orgheadline23">ElementaryOS桌面卡死</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline1" class="outline-2">
<h2 id="orgheadline1">eOS截图</h2>
<div class="outline-text-2" id="text-orgheadline1">

<div class="figure">
<p><img src="../images/elementaryos.jpg" alt="elementaryos.jpg" />
</p>
</div>
</div>
</div>
<div id="outline-container-orgheadline2" class="outline-2">
<h2 id="orgheadline2">选择阿里云的源</h2>
<div class="outline-text-2" id="text-orgheadline2">
<p>
按住Alt+F2，搜Software &amp; Updates，选择软件源到阿里云的源，速度会快上很多。接着就是标准的 <code>sudo apt-get update</code> 和 <code>sudo apt-get upgrade</code> 了。
</p>

<p>
或者下载Lantern代理，在命令行设置http代理，也能无障碍的update &amp; upgrade
</p>
<div class="org-src-container">

<pre class="src src-sh"><span style="color: #6c71c4;">export</span> <span style="color: #6c71c4;">http_proxy</span>=http://127.0.0.1:8787
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline3" class="outline-2">
<h2 id="orgheadline3">安装受版权限制的软件</h2>
<div class="outline-text-2" id="text-orgheadline3">
<p>
有很多包由于版权的限制，不能集成在系统里发行。包括一些第三方的解码器，微软的TrueType字体，java等。这些包是放在源里可以安装的，在Software &amp; Updates里可以看到有一项源叫做 <code>Software restricted by copyright or legal issues</code> 。这些包可以通过下面这个命令安装。
</p>
<div class="org-src-container">

<pre class="src src-sh">sudo apt-get install ubuntu-restricted-extras
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline4" class="outline-2">
<h2 id="orgheadline4">安装系统监控器</h2>
<div class="outline-text-2" id="text-orgheadline4">
<p>
系统监控器是gnome套件中的一个好用的系统资源使用情况查看器。推荐使用。
</p>
<div class="org-src-container">

<pre class="src src-sh">sudo apt-get install gnome-system-monitor
</pre>
</div>

<p>
参考
</p>
<ul class="org-ul">
<li><a href="http://www.webupd8.org/2012/03/official-gnome-shell-extensions-weather.html">offical gnome shell extensions</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline5" class="outline-2">
<h2 id="orgheadline5">用户脚本目录.usrbin</h2>
<div class="outline-text-2" id="text-orgheadline5">
<p>
在 <code>~/</code> 目录下面，创建一个.usrbin文件夹，并且在 ~/.profile 里把它放置到PATH的最前面。
</p>
<div class="org-src-container">

<pre class="src src-sh"><span style="color: #6c71c4;">export</span> $<span style="color: #6c71c4;">PATH</span>=$<span style="color: #6c71c4;">HOME</span>/.usrbin:$<span style="color: #6c71c4;">PATH</span>
</pre>
</div>

<p>
执行命令 <code>source ~/.profile</code> 使改动立即生效。
</p>

<p>
里面可以放一些你自己写的shell脚本、python脚本等，还可以用同名的命令覆盖系统命令，比如emacs，sublime，在修改emacs启动闪退，sublime中文支持上面很方便。
</p>

<p>
例如，用scratch创建一个text文件 <code>scratch-text-editor ~/.usrbin/text</code>, 其中，内容如下
</p>
<div class="org-src-container">

<pre class="src src-sh"><span style="color: #586e75; font-style: italic;">#</span><span style="color: #586e75; font-style: italic;">!/bin/</span><span style="color: #859900;">bash</span>
<span style="color: #6c71c4;">GTK_IM_MODULE</span>=<span style="color: #2aa198;">"xim"</span> exec /usr/bin/scratch-text-editor <span style="color: #2aa198;">"$@"</span>
</pre>
</div>

<p>
然后，用chmod添加可执行的属性， <code>chmod +x ~/.usrbin/text</code>
</p>

<p>
现在就可以在命令行下面，使用text打开scratch了，会方便很多。同时，前缀GTK_IM_MODULE="xim"是使scratch支持中文输入法。
</p>
</div>
</div>

<div id="outline-container-orgheadline6" class="outline-2">
<h2 id="orgheadline6">改主机名称</h2>
<div class="outline-text-2" id="text-orgheadline6">
<p>
装系统的时候，脑子一抽把主机名子起的特别难听。在命令行下面不好看，后来专门去网搜了一下怎么改主机名，把方法在这记录一下。<br  />
</p>

<p>
先执行命令 <code>sudo text /etc/hostname</code> ,文件里面存储的是旧的计算机名字，把它改为你想要的名字。我给改成了eOS。保存。
</p>

<p>
运行命令 <code>sudo gedit /etc/hosts</code> ，里面的内容大概如下。更改127.0.1.1位置的值，使它跟你刚才输入的计算机名字相符，完成后保存文件。
</p>
<div class="org-src-container">

<pre class="src src-sh">127.0.0.1 localhost
127.0.1.1 eOS
</pre>
</div>

<p>
重启后，机器就会显示新的名字了。
</p>

<p>
参考：
</p>
<ul class="org-ul">
<li><a href="http://os.51cto.com/art/201311/416060.htm">Ubuntu每日小技巧——怎样修改你的计算机名字</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline7" class="outline-2">
<h2 id="orgheadline7">安装gdebi工具</h2>
<div class="outline-text-2" id="text-orgheadline7">
<p>
debi是一个包安装工具，图形化的界面，所以使用很方便，强烈建议安装。
</p>
<div class="org-src-container">

<pre class="src src-sh">sudo apt-get install debi
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline8" class="outline-2">
<h2 id="orgheadline8">安装Emacs24.5</h2>
<div class="outline-text-2" id="text-orgheadline8">
<p>
emacs最新的24.5没有deb包，只能从源码安装了。下载最新的24.5的tar.xz包 <a href="http://ftpmirror.gnu.org/emacs/">http://ftpmirror.gnu.org/emacs/</a>
</p>

<p>
在下载emacs源码的过程中，可以安装其他需要用到的工具。
</p>
<div class="org-src-container">

<pre class="src src-sh">sudo apt-get install checkinstall
sudo apt-get install build-essential
sudo apt-get build-dep emacs24
</pre>
</div>

<p>
下载文件为emacs-24.5.tar.xz。邮件Extract Here，进入该文件夹再邮件 Open In -&gt; Terminal。依次执行以下命令。
</p>
<div class="org-src-container">

<pre class="src src-sh">./configure --prefix=/usr
make
checkinstall
</pre>
</div>

<p>
其中，&#x2013;prefix参数是指定emacs安装的目录。我习惯安装在usr目录，而不是默认的/usr/local目录。checkinstall命令是将编译好的emacs打包成deb包，然后用户再用gdebi安装，这样的好处是，可以方便的用apt-get去卸载。如果直接make install的话，还需要保留源码才能再需要卸载的时候卸载掉。
</p>

<p>
我的机器是x86的，我已经打包好了一个x86版本的deb包，可以去百度云盘上下载安装。
</p>

<p>
参考:
</p>
<ul class="org-ul">
<li><a href="http://ubuntuhandbook.org/index.php/2014/10/emacs-24-4-released-install-in-ubuntu-14-04/">Emacs 24.4 Released, How to Install it in Ubuntu 14.04</a></li>
<li><a href="http://www.ibm.com/developerworks/cn/linux/l-cn-checkinstall/index.html">Linux 的源码安装工具 CheckInstall</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline9" class="outline-2">
<h2 id="orgheadline9">安装Atom</h2>
<div class="outline-text-2" id="text-orgheadline9">
<p>
Atom没有提供x86版本的deb包，但是确实是支持x86的。64位版本的deb包在Atom的官网就可以下载。32位的机器可以用PPA下载安装。
</p>

<p>
32位和64位的机器都可以使用PPA安装，命令如下：
</p>
<div class="org-src-container">

<pre class="src src-sh">sudo add-apt-repository ppa:webupd8team/atom
sudo apt-get update
sudo apt-get install atom
</pre>
</div>

<p>
64位的电脑可以去官方网站上下载安装包： <a href="https://atom.io/">https://atom.io/</a> ，然后，直接用debi打开就可以安装了。
</p>
</div>
</div>

<div id="outline-container-orgheadline10" class="outline-2">
<h2 id="orgheadline10">安装Sublime Text 3</h2>
<div class="outline-text-2" id="text-orgheadline10">
<p>
去官方网站 <a href="http://www.sublimetext.com/3">下载Sublime</a> 的deb安装包，右键用gdebi打开。点击 Install Package就可以了。
</p>

<p>
在ElementaryOS Freya上，安装的Sublime Text 3是没办法输入中文的。想要支持中文还需要配置一下，后面有说明如何配置的。
</p>
</div>
</div>

<div id="outline-container-orgheadline11" class="outline-2">
<h2 id="orgheadline11">安装StarUML</h2>
<div class="outline-text-2" id="text-orgheadline11">
<p>
StartUML是原作者近期开发的新的UML画图软件，保留了之前的强大功能的基础上，增加了更多功能和支持了多个操作系统。虽然是收费的软件，但是无限期试用的。只不过会隔一段时间弹出来一个提示框让你购买而已。个人觉得作者还是挺厚道的，这里就不连接到下载页面了，大家去官网找下载入口吧。
</p>


<div class="figure">
<p><img src="http://staruml.io/image/screenshot.png" alt="screenshot.png" />
</p>
</div>

<ul class="org-ul">
<li>官方网址：<a href="http://staruml.io/">http://staruml.io/</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline12" class="outline-2">
<h2 id="orgheadline12">安装SmartGit</h2>
<div class="outline-text-2" id="text-orgheadline12">
<p>
SmartGit是一个跨linux、win、mac三个平台的git版本控制软件。用习惯了的话，非常好用。可以免费用于非商业用途。
</p>

<p>
安装通过去官网下载deb安装包，然后使用debi安装即可。官网的下载可能会比较慢，需要耐心等待或者Lantern一下。
</p>

<p>
参考：
</p>
<ul class="org-ul">
<li>官方网站：<a href="http://www.syntevo.com/smartgit/download">http://www.syntevo.com/smartgit/download</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline13" class="outline-2">
<h2 id="orgheadline13">安装Elementary Tweaks</h2>
<div class="outline-text-2" id="text-orgheadline13">
<p>
Elementary Tweaks是eOS上一个增强配置的工具。可以个性化的定制自己的eOS，包括修改UI和窗口按钮布局，修改主题，修改icon，修改文件管理器的单双击等。
</p>

<p>
Freya安装Elementary Tweaks可以通过PPA安装：
</p>
<div class="org-src-container">

<pre class="src src-sh">sudo add-apt-repository ppa:mpstark/elementary-tweaks-daily
sudo apt-get update
sudo apt-get install elementary-tweaks
</pre>
</div>

<p>
参考：
</p>
<ul class="org-ul">
<li><a href="http://itsfoss.com/install-elementary-tweaks-in-elementary-os-freya-luna/">How To Install Elementary Tweaks In Elementary OS Freya &amp; Luna</a></li>
<li><a href="http://itsfoss.com/install-themes-icons-elementary-os-freya/">Install themes and icons in Elementary OS Freya</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline14" class="outline-2">
<h2 id="orgheadline14">安装oracle-jdk</h2>
<div class="outline-text-2" id="text-orgheadline14">
<p>
自带的源里带的是open-jdk。如果想安装oracle就得用ppa源安装，这是最简单的方法了。
</p>
<div class="org-src-container">

<pre class="src src-sh">sudo apt-add-repository ppa:webupd8team/java
sudo apt-get update
sudo apt-get install oracle-java8-installer
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline15" class="outline-2">
<h2 id="orgheadline15">安装IntelliJ-IDEA</h2>
<div class="outline-text-2" id="text-orgheadline15">
<p>
去官网下载tar.sz包，选择社区版。社区版本可以免费用于非商业用途，作为个人试用基本够了。如果是公司试用的话，公司会去购买的。
</p>

<p>
解压后放在合适的位置，比如/usr/share里，然后进入ideaC/bin目录，运行idea.sh。运行后，可以在Tools里找到Create Desktop Shortcut就能在菜单里找到了。
</p>

<p>
同样，也可以安装Pycharm。下载过程中会有网速限制，建议直接Lantern一下。
</p>

<ul class="org-ul">
<li>官网下载页面：<a href="https://www.jetbrains.com/idea/download/">https://www.jetbrains.com/idea/download/</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline16" class="outline-2">
<h2 id="orgheadline16">安装Google Chrome</h2>
<div class="outline-text-2" id="text-orgheadline16">
<p>
可以去官网下载deb包安装 <a href="https://www.google.com/intl/en-US/chrome/browser/">https://www.google.com/intl/en-US/chrome/browser/</a> 下载后用gdebi安装即可。
</p>

<p>
注意，chromium可以直接在软件中心安装，但是chromium和google chrome是有区别的，从用户角度则是图标不一样，不需要安装falsh插件等等。安装chromium可以直接命令行安装。
</p>

<p>
<b>启动时出现两个chrome图标问题</b> : 在/usr/share/applications/google-stable.desktop中添加一项 <code>StartupWMClass=Google-chrome-stable</code> 之后，再启动chrome浏览器Dock栏就不会出现连个chrome图标了。
</p>

<p>
参考：
</p>
<ul class="org-ul">
<li><a href="http://itsfoss.com/rid-google-chrome-icons-dock-elementary-os-freya/">http://itsfoss.com/rid-google-chrome-icons-dock-elementary-os-freya/</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline17" class="outline-2">
<h2 id="orgheadline17">安装Lantern</h2>
<div class="outline-text-2" id="text-orgheadline17">
<p>
Lantern是一个p2p网络代理软件，主旨是所有人都可以自由的访问互联网，她的前提是基于大部分被禁止访问的网址并不是因为他们的内容非法，比如技术类的网站。
</p>

<p>
去这里下载你的系统对应的版本，然后安装就可以了。Ubuntu下用gdebi安装，就能使用了。
<a href="https://github.com/getlantern/lantern/releases/tag/latest">https://github.com/getlantern/lantern/releases/tag/latest</a>
</p>

<p>
在命令行下面指定apt-get使用代理，还要执行一个命令。 <code>export http_proxy=http:127.0.0.1:8787</code>
</p>

<p>
我上外网主要是看一些技术的文章和下载一些技术软件，所以基本满足需求了。至于政治那么高端的东西，我个人觉得我的智商还判断不了外网那些新闻短片的真假性，所以从来不看。
</p>
</div>
</div>

<div id="outline-container-orgheadline18" class="outline-2">
<h2 id="orgheadline18">安装搜狗输入法</h2>
<div class="outline-text-2" id="text-orgheadline18">
<p>
先要删除系统自带的ibus输入法 <code>sudo apt-get remove ibus</code> 下载官网的输入法安装包，用debi打开安装就可以了。我是重启后才能正常使用，不知道是不是都需要这样。
</p>

<ul class="org-ul">
<li><a href="http://pinyin.sogou.com/linux/?r=pinyin">搜狗输入法 for linux</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline19" class="outline-2">
<h2 id="orgheadline19">Atom支持中文显示</h2>
<div class="outline-text-2" id="text-orgheadline19">
<p>
在设置（packages-&gt;Setting View-&gt;Open 或者 Ctrl+,）的font-family里填下面的字体，注意要加最后的分号。下面的字体是系统自带的，可以改成你喜好的字体，我用的是从拷贝过来的Consolas和Yahei字体 <code>Droid Sans Mono, Droid Sans Fallback;</code> , 网上还有一些免费的中文字体，大家可以选用。
</p>

<p>
字体：
</p>
<ul class="org-ul">
<li><a href="http://wiki.ubuntu.com.cn/%E5%85%8D%E8%B4%B9%E4%B8%AD%E6%96%87%E5%AD%97%E4%BD%93">免费中文字体-Ubuntu中文论坛</a></li>
<li><a href="http://wenq.org/wqy2/index.cgi">文泉驿自由字体</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline20" class="outline-2">
<h2 id="orgheadline20">Sublime支持中文输入</h2>
<div class="outline-text-2" id="text-orgheadline20">
<p>
进入到我们的usrbin目 <code>cd ~/.usrbin</code>, 添加文件subl_im.c，代码如下：
</p>
<div class="org-src-container">

<pre class="src src-c"><span style="color: #d33682;">#include</span> <span style="color: #2aa198;">&lt;gtk/gtkimcontext.h&gt;</span>
<span style="color: #268bd2;">void</span> <span style="color: #b58900;">gtk_im_context_set_client_window</span>(<span style="color: #268bd2;">GtkIMContext</span> *<span style="color: #6c71c4;">context</span>, <span style="color: #268bd2;">GdkWindow</span> *<span style="color: #6c71c4;">window</span>) {
   <span style="color: #268bd2;">GtkIMContextClass</span> *<span style="color: #6c71c4;">klass</span>;
   g_return_if_fail (GTK_IS_IM_CONTEXT (context));
   klass = GTK_IM_CONTEXT_GET_CLASS (context);
   <span style="color: #859900;">if</span> (klass-&gt;set_client_window)
       klass-&gt;set_client_window (context, window);

   g_object_set_data(G_OBJECT(context),<span style="color: #2aa198;">"window"</span>,window);

   <span style="color: #859900;">if</span> (<span style="color: #268bd2;">!</span>GDK_IS_WINDOW(window))
       <span style="color: #859900;">return</span>;

   <span style="color: #268bd2;">int</span> <span style="color: #6c71c4;">width</span> = gdk_window_get_width(window);
   <span style="color: #268bd2;">int</span> <span style="color: #6c71c4;">height</span> = gdk_window_get_height(window);

   <span style="color: #859900;">if</span> (width != 0 &amp;&amp; height != 0)
       gtk_im_context_focus_in(context);
}
</pre>
</div>

<p>
安装gtk2.0的开发包 <code>sudo apt-get install libgtk2.0-dev</code> 执行编译命令
</p>
<div class="org-src-container">

<pre class="src src-sh">gcc -shared -o libsubl-im.so subl_im.c <span style="color: #d33682;">`pkg-config --libs --cflags gtk+-2.0`</span> -fPIC
</pre>
</div>

<p>
创建subl文件， <code>text ~/.usrbin/subl</code>
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #586e75; font-style: italic;">#</span><span style="color: #586e75; font-style: italic;">!/usr/bin/env python</span>

<span style="color: #859900;">import</span> sys
<span style="color: #859900;">import</span> os
<span style="color: #859900;">import</span> subprocess

<span style="color: #859900;">def</span> <span style="color: #b58900;">run</span>():
    <span style="color: #6c71c4;">exe</span> = <span style="color: #2aa198;">"/opt/sublime_text/sublime_text"</span>
    <span style="color: #6c71c4;">cwd</span> = os.getcwd()
    <span style="color: #6c71c4;">cmd</span> = [exe]

    <span style="color: #859900;">if</span> <span style="color: #6c71c4;">len</span>(sys.argv) &gt;= 2:
        <span style="color: #6c71c4;">path</span> = sys.argv[1]

        <span style="color: #859900;">if</span> path.startswith(<span style="color: #2aa198;">"file"</span>):
            <span style="color: #6c71c4;">path</span> = path[5:]

        <span style="color: #859900;">if</span> <span style="color: #859900;">not</span> os.path.isabs(path):
            <span style="color: #6c71c4;">path</span> = os.path.join(os.getcwd(), path)

        <span style="color: #6c71c4;">cmd</span> = [exe, path]

    <span style="color: #6c71c4;">env</span> = <span style="color: #6c71c4;">dict</span>(os.environ)
    <span style="color: #6c71c4;">env</span>[<span style="color: #2aa198;">'LD_PRELOAD'</span>] = os.path.expanduser(<span style="color: #2aa198;">'~/.usrbin/libsubl-im.so'</span>)
    subprocess.Popen(cmd, env=env)

run()
</pre>
</div>

<p>
修改文件使其可以执行 <code>sudo chmod +x sublime_text</code>
</p>

<p>
用Launcher Manager修改subl的desktop文件，/opt/sublime_text/sublime_text %F 改为subl %F
</p>

<p>
现在不管是在命令行，还是菜单中进入，都可以输入中文了。
</p>
</div>
</div>

<div id="outline-container-orgheadline21" class="outline-2">
<h2 id="orgheadline21">Scratch支持中文输入</h2>
<div class="outline-text-2" id="text-orgheadline21">
<p>
在.usrbin目录下创建scratch-text-editor
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #586e75; font-style: italic;">#</span><span style="color: #586e75; font-style: italic;">!/usr/bin/env python</span>

<span style="color: #859900;">import</span> sys
<span style="color: #859900;">import</span> os
<span style="color: #859900;">import</span> subprocess

<span style="color: #859900;">def</span> <span style="color: #b58900;">run</span>():
    <span style="color: #6c71c4;">exe</span> = <span style="color: #2aa198;">"/usr/bin/scratch-text-editor"</span>
    <span style="color: #6c71c4;">cwd</span> = os.getcwd()
    <span style="color: #6c71c4;">cmd</span> = [exe]

    <span style="color: #859900;">if</span> <span style="color: #6c71c4;">len</span>(sys.argv) &gt;= 2:
        <span style="color: #6c71c4;">path</span> = sys.argv[1]

        <span style="color: #859900;">if</span> path.startswith(<span style="color: #2aa198;">"file"</span>):
            <span style="color: #6c71c4;">path</span> = path[5:]

        <span style="color: #859900;">if</span> <span style="color: #859900;">not</span> os.path.isabs(path):
            <span style="color: #6c71c4;">path</span> = os.path.join(os.getcwd(), path)

        <span style="color: #6c71c4;">cmd</span> = [exe, path]

    <span style="color: #6c71c4;">env</span> = <span style="color: #6c71c4;">dict</span>(os.environ)
    <span style="color: #6c71c4;">env</span>[<span style="color: #2aa198;">'GTK_IM_MODULE'</span>] = <span style="color: #2aa198;">"xim"</span>
    subprocess.Popen(cmd, env=env)

run()
</pre>
</div>

<p>
然后再chmod一下，添加可执行权限 <code>chmod +x scratch-text-editor</code>
</p>
</div>
</div>

<div id="outline-container-orgheadline22" class="outline-2">
<h2 id="orgheadline22">Emacs中文输入和闪退问题</h2>
<div class="outline-text-2" id="text-orgheadline22">
<p>
在usrbin目录下创emacs文件 内容改为
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #586e75; font-style: italic;">#</span><span style="color: #586e75; font-style: italic;">!/usr/bin/env python</span>

<span style="color: #859900;">import</span> sys
<span style="color: #859900;">import</span> os
<span style="color: #859900;">import</span> subprocess

<span style="color: #859900;">def</span> <span style="color: #b58900;">run</span>():
    <span style="color: #6c71c4;">exe</span> = <span style="color: #2aa198;">"/usr/bin/emacs"</span>
    <span style="color: #6c71c4;">cwd</span> = os.getcwd()
    <span style="color: #6c71c4;">cmd</span> = [exe]

    <span style="color: #859900;">if</span> <span style="color: #6c71c4;">len</span>(sys.argv) &gt;= 2:
        <span style="color: #6c71c4;">path</span> = sys.argv[1]

        <span style="color: #859900;">if</span> path.startswith(<span style="color: #2aa198;">"file"</span>):
            <span style="color: #6c71c4;">path</span> = path[5:]

        <span style="color: #859900;">if</span> <span style="color: #859900;">not</span> os.path.isabs(path):
            <span style="color: #6c71c4;">path</span> = os.path.join(os.getcwd(), path)

        <span style="color: #6c71c4;">cmd</span> = [exe, path]

    <span style="color: #6c71c4;">env</span> = <span style="color: #6c71c4;">dict</span>(os.environ)
    <span style="color: #6c71c4;">env</span>[<span style="color: #2aa198;">'XLIB_SKIP_ARGB_VISUALS'</span>] = <span style="color: #2aa198;">'1'</span>
    <span style="color: #6c71c4;">env</span>[<span style="color: #2aa198;">'LC_CTYPE'</span>] = <span style="color: #2aa198;">'zh_CN.UTF-8'</span>
    subprocess.Popen(cmd, env=env)

run()
</pre>
</div>

<p>
用Launcher Manager修改emacs的Exec为emacs %F。如果在Launchaer Manager找不到emacs的图标，就去/usr/share/applications下找emacs24.desktop这个文件，直接sudo修改这个文件的Exec那一行，Exec=emacs %F。
</p>
<div class="org-src-container">

<pre class="src src-sh">[Desktop Entry]
<span style="color: #6c71c4;">Version</span>=1.0
<span style="color: #6c71c4;">Name</span>=GNU Emacs 24
<span style="color: #6c71c4;">GenericName</span>=Text Editor
<span style="color: #6c71c4;">Comment</span>=View and edit files
<span style="color: #6c71c4;">MimeType</span>=text/english;text/plain;text/x-makefile;text/x-c++hdr;text/x-c++src;text/x-chdr;text/x-csrc;text/x-java;text/x-moc;text/x-pascal;text/x-tcl;text/x-tex;application/x-shellscript;text/x-c;text/x-c++;
<span style="color: #6c71c4;">Exec</span>=emacs %F
<span style="color: #6c71c4;">TryExec</span>=emacs
<span style="color: #6c71c4;">Icon</span>=/usr/share/icons/hicolor/scalable/apps/emacs24.svg
<span style="color: #6c71c4;">Type</span>=Application
<span style="color: #6c71c4;">Terminal</span>=false
<span style="color: #6c71c4;">Categories</span>=Utility;Development;TextEditor;
<span style="color: #6c71c4;">StartupWMClass</span>=Emacs24
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline23" class="outline-2">
<h2 id="orgheadline23">ElementaryOS桌面卡死</h2>
<div class="outline-text-2" id="text-orgheadline23">
<p>
按快捷键 <code>Ctrl+Alt+F1</code> 进入tty1，输入命令 <code>sudo service lightdm restart</code>, 这是会进入到登陆界面，但是之前的工作都丢失了。
</p>

<p>
这两天频繁遇到卡死的问题，网上没有找到解决方法。重新选了显卡驱动也没有解决，后面如果解决了跟进记录在这里。
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: 2015-08-26</p>
<p class="validation"></p>
</div>
</body>
</html>
